<%- contentFor('body') %>
<div class="hero-section bg-primary text-white py-5 mb-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-3">Quản lý sản phẩm hiệu quả</h1>
                <p class="lead">Hệ thống quản lý sản phẩm và nhà cung cấp đầy đủ tính năng, giúp bạn theo dõi kho hàng và quản lý doanh nghiệp một cách chuyên nghiệp.</p>
                <% if (!user) { %>
                    <div class="mt-4">
                        <a href="/auth/register" class="btn btn-light btn-lg me-3">Đăng ký ngay</a>
                        <a href="/auth/login" class="btn btn-outline-light btn-lg">Đăng nhập</a>
                    </div>
                <% } %>
            </div>
            <div class="col-lg-4 text-center">
                <i class="bi bi-boxes display-1"></i>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <!-- Stats cards -->
    <% if (user) { %>
        <div class="row mb-5">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="text-primary mb-2">
                            <i class="bi bi-box display-6"></i>
                        </div>
                        <h3 class="text-primary"><%= stats.totalProducts %></h3>
                        <p class="text-muted mb-0">Sản phẩm</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="text-success mb-2">
                            <i class="bi bi-building display-6"></i>
                        </div>
                        <h3 class="text-success"><%= stats.totalSuppliers %></h3>
                        <p class="text-muted mb-0">Nhà cung cấp</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="text-info mb-2">
                            <i class="bi bi-people display-6"></i>
                        </div>
                        <h3 class="text-info"><%= stats.totalUsers %></h3>
                        <p class="text-muted mb-0">Người dùng</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body text-center">
                        <div class="text-warning mb-2">
                            <i class="bi bi-exclamation-triangle display-6"></i>
                        </div>
                        <h3 class="text-warning"><%= stats.lowStockProducts %></h3>
                        <p class="text-muted mb-0">Sắp hết hàng</p>
                    </div>
                </div>
            </div>
        </div>
    <% } %>

    <div class="row">
        <!-- Search by supplier -->
        <div class="col-lg-4 mb-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0">
                    <h5 class="mb-0">
                        <i class="bi bi-building text-primary"></i>
                        Tìm theo nhà cung cấp
                    </h5>
                </div>
                <div class="card-body">
                    <% if (suppliers && suppliers.length > 0) { %>
                        <div class="list-group list-group-flush">
                            <% suppliers.slice(0, 8).forEach(supplier => { %>
                                <a href="/suppliers/<%= supplier._id %>/products" class="list-group-item list-group-item-action border-0 px-0">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1"><%= supplier.name %></h6>
                                            <p class="text-muted mb-0 small">
                                                <i class="bi bi-geo-alt"></i>
                                                <%= supplier.address %>
                                            </p>
                                        </div>
                                        <i class="bi bi-chevron-right text-muted"></i>
                                    </div>
                                </a>
                            <% }); %>
                        </div>
                        <% if (suppliers.length > 8) { %>
                            <div class="text-center mt-3">
                                <a href="/suppliers" class="btn btn-outline-primary btn-sm">
                                    Xem tất cả (<%= suppliers.length %>)
                                </a>
                            </div>
                        <% } %>
                    <% } else { %>
                        <p class="text-muted">Chưa có nhà cung cấp nào.</p>
                        <% if (user) { %>
                            <a href="/suppliers/new" class="btn btn-primary btn-sm">Thêm nhà cung cấp</a>
                        <% } %>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Latest products -->
        <div class="col-lg-8 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-box text-primary"></i>
                            Sản phẩm mới nhất
                        </h5>
                        <% if (user) { %>
                            <a href="/products" class="btn btn-outline-primary btn-sm">Xem tất cả</a>
                        <% } %>
                    </div>
                </div>
                <div class="card-body">
                    <% if (latestProducts && latestProducts.length > 0) { %>
                        <div class="row">
                            <% latestProducts.forEach(product => { %>
                                <div class="col-lg-6 mb-3">
                                    <div class="d-flex">
                                        <div class="flex-shrink-0">
                                            <div class="bg-light rounded d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                                <i class="bi bi-box text-primary"></i>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="mb-1">
                                                <% if (user) { %>
                                                    <a href="/products/<%= product._id %>" class="text-decoration-none">
                                                        <%= product.name %>
                                                    </a>
                                                <% } else { %>
                                                    <%= product.name %>
                                                <% } %>
                                            </h6>
                                            <p class="text-muted small mb-1">
                                                <i class="bi bi-building"></i>
                                                <%= product.supplier ? product.supplier.name : 'N/A' %>
                                            </p>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="text-primary fw-bold"><%= product.formattedPrice %></span>
                                                <span class="badge bg-<%= product.quantity > 10 ? 'success' : product.quantity > 0 ? 'warning' : 'danger' %>">
                                                    SL: <%= product.quantity %>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    <% } else { %>
                        <p class="text-muted text-center py-4">Chưa có sản phẩm nào.</p>
                        <% if (user) { %>
                            <div class="text-center">
                                <a href="/products/new" class="btn btn-primary">Thêm sản phẩm đầu tiên</a>
                            </div>
                        <% } %>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <!-- Top suppliers by products -->
    <% if (user && supplierStats && supplierStats.length > 0) { %>
        <div class="row mt-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0">
                        <h5 class="mb-0">
                            <i class="bi bi-bar-chart text-primary"></i>
                            Top nhà cung cấp
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <% supplierStats.forEach(stat => { %>
                                <div class="col-lg-4 mb-3">
                                    <div class="card border">
                                        <div class="card-body">
                                            <h6 class="card-title">
                                                <a href="/suppliers/<%= stat.supplier._id %>" class="text-decoration-none">
                                                    <%= stat.supplier.name %>
                                                </a>
                                            </h6>
                                            <div class="row text-center">
                                                <div class="col-4">
                                                    <div class="text-primary fw-bold"><%= stat.productCount %></div>
                                                    <small class="text-muted">Sản phẩm</small>
                                                </div>
                                                <div class="col-4">
                                                    <div class="text-success fw-bold"><%= stat.totalQuantity %></div>
                                                    <small class="text-muted">Số lượng</small>
                                                </div>
                                                <div class="col-4">
                                                    <div class="text-info fw-bold"><%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(stat.totalValue) %></div>
                                                    <small class="text-muted">Giá trị</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <% } %>

    <!-- Features for anonymous users -->
    <% if (!user) { %>
        <div class="row mt-5">
            <div class="col-12">
                <h2 class="text-center mb-5">Tính năng nổi bật</h2>
            </div>
            <div class="col-md-4 mb-4">
                <div class="text-center">
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                        <i class="bi bi-box-seam fs-3"></i>
                    </div>
                    <h4>Quản lý sản phẩm</h4>
                    <p class="text-muted">Theo dõi thông tin sản phẩm, giá cả, số lượng tồn kho một cách chi tiết và chính xác.</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="text-center">
                    <div class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                        <i class="bi bi-building fs-3"></i>
                    </div>
                    <h4>Quản lý nhà cung cấp</h4>
                    <p class="text-muted">Lưu trữ thông tin nhà cung cấp, liên hệ và theo dõi mối quan hệ hợp tác.</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="text-center">
                    <div class="bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                        <i class="bi bi-search fs-3"></i>
                    </div>
                    <h4>Tìm kiếm thông minh</h4>
                    <p class="text-muted">Tìm kiếm sản phẩm theo tên, nhà cung cấp hoặc bất kỳ thông tin nào một cách nhanh chóng.</p>
                </div>
            </div>
        </div>
    <% } %>
</div>